/*!
 * Start Bootstrap - SB Admin v4.0.0-beta.2 (https://startbootstrap.com/template-overviews/sb-admin)
 * Copyright 2013-2017 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap-sb-admin/blob/master/LICENSE)
 */
Chart.defaults.global.defaultFontFamily = '-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif',
    Chart.defaults.global.defaultFontColor = "#292b2c";
var ctx = document.getElementById("myAreaChart");
var labels = {{ json_data| safe }};
var red = "bg-danger";
var redtext = "红色预警";
var yellow = "bg-warning";
var yellowtext = "黄色预警";
var green = "bg-success";
var greentext = "情况正常";

var data = [12223, 22222, 33311, 24411, 35552, 25554, 12312, 23423, 21123, 34353, 12321, 32423, 23123];
myLineChart = new Chart(ctx,
    {
        type: "line",
        data: {
            labels: labels,
            datasets: [
                {
                    label: "Sessions",
                    lineTension: .3,
                    backgroundColor: "rgba(2,117,216,0.2)",
                    borderColor: "rgba(2,117,216,1)",
                    pointRadius: 5,
                    pointBackgroundColor: "rgba(2,117,216,1)",
                    pointBorderColor: "rgba(255,255,255,0.8)",
                    pointHoverRadius: 5,
                    pointHoverBackgroundColor: "rgba(2,117,216,1)",
                    pointHitRadius: 20,
                    pointBorderWidth: 2,
                    data: data
                }
            ]
        },
        options: {
            scales: {
                xAxes: [{
                    time: {unit: "date"},
                    gridLines: {display: !1},
                    ticks: {maxTicksLimit: 7}
                }],
                yAxes: [{
                    ticks: {min: 0, max: 4e4, maxTicksLimit: 5},
                    gridLines: {color: "rgba(0, 0, 0, .125)"}
                }]
            },
            legend: {display: !1},
            //animation : true
        }
    }
)
setInterval(function area_flush() {
    $.ajax("/part_flush/", {
        type: "GET",
        url: "/part_flush/",
        dataType: "json",
        success: function (data) {
            var k = "";
            var s = 0;
            k = data[0];
            s = data[1];
            myLineChart.data.labels.pop();
            myLineChart.data.labels.unshift(k);
            myLineChart.data.datasets[0].data.pop();
            myLineChart.data.datasets[0].data.unshift(s);
            myLineChart.update();
            console.log("更新时间:" + k);
            console.log("当前人流量:" + s.toString() + "人次");
            var color = "";
            var text = "";
            if (s > 10000) {
                color = red;
                text = redtext;
            } else if (s < 10000 && s >= 500) {
                color = yellow;
                text = yellowtext;
            } else {
                color = green;
                text = greentext;
            }
            document.getElementById("icon_cards").className = "card text-white " + color + " o-hidden h-100 w-100";
            document.getElementById("sos").innerHTML = "当前状态:" + text;
            document.getElementById("update_time").innerHTML = "更新时间:" + k;
            document.getElementById("update_flow").innerHTML = "当前人流量:" + s.toString() + "人次";
        },
        error: function () {
            error("获取数据错误");
        }
    })
}, 5000);

ctx = document.getElementById("myBarChart");
myBarChart = new Chart(ctx,
    {
        type: "bar",
        data: {
            labels: ["周一", "周二", "周三", "周四", "周五", "周六", "周日"],
            datasets: [
                {
                    label: "人流量",
                    backgroundColor: "rgba(2,117,216,1)",
                    borderColor: "rgba(2,117,216,1)",
                    data: [4215, 5312, 6251, 7841, 9821, 14984, 12345]
                }
            ]
        },
        options: {
            scales: {
                xAxes: [
                    {
                        time: {
                            unit: "month"
                        },
                        gridLines: {
                            display: !1
                        },
                        ticks: {
                            maxTicksLimit: 6
                        }
                    }
                ],
                yAxes: [
                    {
                        ticks:
                            {
                                min: 0,
                                max: 15e3,
                                maxTicksLimit: 5
                            },
                        gridLines: {display: !0}
                    }]
            }, legend: {display: !1}
        }
    }), ctx = document.getElementById("myPieChart"), myPieChart = new Chart(ctx, {
    type: "pie",
    data: {
        labels: ["正常", "红色预警", "黄色预警"],
        datasets: [{data: [3, 2, 2], backgroundColor: ["#007bff", "#dc3545", "#ffc107"]}]
    }
});